# ✏️ 기억에 남는 내용

## 소스코드의 타입
---
소스코드: 실행 가능한 코드
+ **전역 코드**
  - 전역에 존재하는 코드, 전역 코드가 평가되면 전역 실행 컨텍스트가 생성된다.
+ **함수 코드**
  - 지역 스코프를 생성하고 이를 전역 스코프에서 시작하는 스코프 체인의 일원으로 연결하며, 지역 변수, 매개변수, arguments 객체를 관리해야한다.
  - 이를 위해 함수 코드가 평가되면 함수 실행 컨텍스트가 생성된다. 
+ **eval 코드**
  - 엄격 모드에서 자신만의 독자적인 스코프를 생성하기 위해 이 코드가 평가되면 eval 실행 컨텍스트가 생성된다.
+ **모듈 코드**
  - 모듈별로 독립적인 모듈 스코프를 생성하기 위해 모듈 코드가 평가되면 모듈 실행 컨텍스트가 생성된다.

## 소스코드의 평가와 실행
---
자바스크립트 엔진은 소스코드를 2개의 과정(소스코드의 평가/실행)으로 나누어 처리한다.
+ **소스코드의 평가**
  - 실행 컨텍스트를 생성하고, 변수/함수등의 선언문을 우선 실행하여 생성된 변수/함수를 실행 컨텍스트가 관리하는 스코프(렉시컬 환경의 환경 레코드)에 등록한다.
+ **소스코드의 실행**
  - '소스코드의 평가' 이후엔 소스코드가 실행되기 시작한다. (런타임 시작)
  - 소스코드 실행에 필요한 정보(변수나 함수의 참조)는 '실행 컨텍스트가 관리하는 스코프'에서 검색하여 취득한다. 소스코드의 실행 결과는 다시 '실행 컨텍스트가 관리하는 스코프'에 등록된다.

## 실행 컨텍스트의 역할
---
+ 코드가 실행되려면 스코프, 식별자, 코드 실행 순서 등의 관리가 필요하다. 
+ 식별자와 스코프는 실행 컨텍스트의 `렉시컬 환경`으로 관리하고 코드 실행 순서는 `실행 컨텍스트 스택`으로 관리한다.

+ 실행 컨텍스트는 소스코드를 실행하는 데 필요한 환경을 제공하고 코드의 실행 결과를 실제로 관리하는 영역이다. (식별자의 등록과, 스코프와 코드 실행 순서 관리를 구현한 내부 메커니즘)

## 실행 컨텍스트 스택
---
- 생성되는 실행 컨텍스트들은 `스택` 자료구조로 관리되고, 이를 실행 컨텍스트 스택이라고 부른다.
- 따라서 실행 컨텍스트 스택은 스택에서 실행 컨텍스트를 푸시, 팝하여 '코드의 실행 순서'를 관리한다.
- 실행 컨텍스트 스택의 최상위에 존재하는 실행 컨텍스트는 언제나 현재 실행 중인 코드의 실행 컨텍스트다.

## 렉시컬 환경
---
- **렉시컬 환경**
  + 식별자와 식별자에 바인딩된 값, 그리고 상위 스코프에 대한 참조를 기록하는 자료구조로 실행 컨텍스트를 구성하는 컴포넌트이다. (스코프와 식별자를 관리)
  + 객체 형태(키+값)의 스코프를 생성하여 식별자를 키로 등록하고, 식별자에 바인딩된 값을 관리한다. 즉 렉시컬 환경은 스코프를 구분하여 식별자를 등록하고 관리하는 저장소 역할을 하는 렉시컬 스코프의 실체다.
  + '환경 레코드', '외부 렉시컬 환경에 대한 참조' 두 개의 컴포넌트로 구성된다.
    * 환경 레코드 (Environment Record): 식별자를 등록하고 그 식별자에 바인딩된 값을 관리하는 저장소다. 
    * 외부 렉시컬 환경에 대한 참조 (Outer Lexical Environment Reference): 상위 스코프(상위 코드의 렉시컬 환경)를 가리킨다. 이를 통해 스코프 체인을 구현한다. 

## 실행 컨텍스트의 생성과 식별자 검색 과정
---
### 1. 전역 객체 생성
### 2. 전역 코드 평가
+ 전역 실행 컨텍스트를 생성한다.
+ 전역 렉시컬 환경을 생성한다.  
  * 전역 환경 레코드(객체 환경 레코드 & 선언적 환경 레코드)를 생성한다.
  * this 바인딩
  * 외부 렉시컬 환경에 대한 참조를 결정한다.
### 3. 전역 코드 실행
### 4. 함수 코드의 평가
  + 함수 실행 컨텍스트를 생성한다.
  + 함수 렉시컬 환경을 생성한다.
    * 함수 환경 레코드를 생성한다.
    * this 바인딩
    * 외부 렉시컬 환경에 대한 참조를 결정한다.
### 5. 함수 코드의 실행
### 6. 함수 코드의 실행 종료
  = 실행 컨텍스트 스택에서 함수 실행 컨텍스트가 팝되어 제거된다.
### 7. 전역 코드 실행 종료
  + 모든 함수코드의 실행이 종료되면 전역 코드의 실행이 종료되고 '전역 실행 컨텍스트'도 실행 컨텍스트 스택에서 팝되어 실행 컨텍스트 스택에는 아무것도 남아있지 않게 된다.

## 실행 컨텍스트와 블록 레벨 스코프
---
+ 코드 블록이 실행되면 해당 코드 블록을 위한 블록 레벨 스코프를 생성하기 위해, 선언적 환경 레코드를 갖는 렉시컬 환경을 새롭게 생성하여 기존의 전역 렉시컬 환경을 교체한다.
+ 이때 새롭게 생성된 코드 블록을 위한 렉시컬 환경의 외부 렉시컬 환경에 대한 참조는 코드 블록이 실행되기 이전의 전역 렉시컬 환경을 가리킨다.
+ 코드 블록의 실행이 종료되면 실행되기 이전의 렉시컬 환경으로 되돌린다.
+ for 문의 변수 선언문에 let 키워드를 사용한 for 문은 코드 블록이 반복해서 실행될 때마다 코드 블록을 위한 새로운 렉시컬 환경을 생성한다. 